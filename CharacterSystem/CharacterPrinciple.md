# è™šæ‹Ÿè§’è‰²ç³»ç»Ÿæ¶æ„è®¾è®¡åŸåˆ™

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†è™šæ‹Ÿè§’è‰²ç³»ç»Ÿçš„å…­å±‚æ¶æ„è®¾è®¡ï¼Œæ—¨åœ¨æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€å±‚æ¬¡æ¸…æ™°ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•çš„è§’è‰²å¯¹è¯ç³»ç»Ÿã€‚è¯¥æ¶æ„æ”¯æŒç¯å¢ƒæ„ŸçŸ¥ã€æƒ…æ„Ÿå»ºæ¨¡ã€è®°å¿†ç®¡ç†ã€åˆ›é€ æ€§è¡¨è¾¾ç­‰å¤šç§é«˜çº§åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **ğŸŒ ç¯å¢ƒæ„ŸçŸ¥**ï¼šé€šè¿‡æ‘„åƒå¤´ã€éº¦å…‹é£ç­‰ä¼ æ„Ÿå™¨ä¸»åŠ¨æ„ŸçŸ¥ç‰©ç†ç¯å¢ƒ
- **ğŸ§  18è¦ç´ è§’è‰²æ¡†æ¶**ï¼šå®Œæ•´çš„è§’è‰²å®šä¹‰å’Œç®¡ç†ç³»ç»Ÿ
- **ğŸ’­ è®°å¿†ä¸æƒ…æ„Ÿ**ï¼šåŠ¨æ€çš„æƒ…ç»ªçŠ¶æ€å’ŒçŸ­é•¿æœŸè®°å¿†ç®¡ç†
- **ğŸ¯ å…³ç³»å»ºæ¨¡**ï¼šæ„ŸçŸ¥å’Œé€‚åº”ä¸ç”¨æˆ·çš„å…³ç³»æ·±åº¦å˜åŒ–
- **ğŸ¨ åˆ›é€ æ€§è¡¨è¾¾**ï¼šå³å…´åˆ›ä½œå’Œå¯Œæœ‰æƒ³è±¡åŠ›çš„äº’åŠ¨èƒ½åŠ›
- **ğŸ“š ä¸Šä¸‹æ–‡ç†è§£**ï¼šæ·±åº¦çš„å¯¹è¯åœºæ™¯å’Œè¯é¢˜è¿½è¸ª
- **ğŸ›¡ï¸ è´¨é‡æ§åˆ¶**ï¼šå¤šå±‚å®‰å…¨è¿‡æ»¤å’Œè¾“å‡ºä¼˜åŒ–
- **ğŸš€ æŒç»­å­¦ä¹ **ï¼šåŸºäºäº¤äº’çš„ä¸ªæ€§åŒ–ä¼˜åŒ–å’Œæˆé•¿æœºåˆ¶

### é€‚ç”¨åœºæ™¯
- æ™ºèƒ½å®¶å±…åŠ©æ‰‹å’Œé™ªä¼´æœºå™¨äºº
- æ¸¸æˆNPCå’Œè™šæ‹Ÿä¸»æ’­è§’è‰²
- æ•™è‚²è¾…å¯¼å’Œæƒ…æ„Ÿæ”¯æŒç³»ç»Ÿ
- AR/VRæ²‰æµ¸å¼ä½“éªŒåº”ç”¨

## å…­å±‚æ¶æ„æ€»è§ˆ

```
ç¬¬5å±‚: å­¦ä¹ é€‚åº”å±‚ (CharacterLearning)
    â†‘ åé¦ˆå­¦ä¹ ã€ä¸ªæ€§åŒ–ä¼˜åŒ–
ç¬¬4å±‚: è¾“å‡ºåå¤„ç†å±‚ (ResponseProcessor)  
    â†‘ æ ¼å¼åŒ–ã€ä¸€è‡´æ€§æ£€æŸ¥ã€å®‰å…¨è¿‡æ»¤
ç¬¬3å±‚: å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†å±‚ (ConversationContext)
    â†‘ åœºæ™¯æ„ŸçŸ¥ã€è¯é¢˜è¿½è¸ªã€ç”¨æˆ·ç”»åƒ
ç¬¬2å±‚: åŠ¨æ€è§’è‰²å®ä¾‹å±‚ (VirtualCharacter)
    â†‘ æƒ…ç»ªçŠ¶æ€ã€è®°å¿†ç®¡ç†ã€åŠ¨æ€æ›´æ–°
ç¬¬1å±‚: é™æ€è§’è‰²æ¨¡æ¿å±‚ (CharacterPromptManager)
    â†‘ åŸºç¡€è®¾å®šã€è§’è‰²æ¡†æ¶ã€é…ç½®æ¨¡æ¿
ç¬¬0å±‚: ç¯å¢ƒæ„ŸçŸ¥å±‚ (EnvironmentPerception) ğŸ†•
    â†‘ ç‰©ç†ä¸–ç•Œæ„ŸçŸ¥ã€å¤šæ¨¡æ€æ•°æ®èåˆ
```

### æ•°æ®æµå‘å›¾

```
ç‰©ç†ä¸–ç•Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
(ä¼ æ„Ÿå™¨æ•°æ®)                                       â”‚
                                                  â–¼
è¾“å…¥æºï¼ˆå¹¶è¡Œï¼‰:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ç”¨æˆ·è¾“å…¥ï¼ˆæ–‡æœ¬ / è¯­éŸ³ / å›¾åƒï¼‰  â”‚   â”‚ ç¬¬0å±‚ï¼šç¯å¢ƒæ„ŸçŸ¥ï¼ˆä¸»åŠ¨/è¢«åŠ¨ï¼‰    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                 â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚              â”‚
                       â–¼              â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ ç¬¬1å±‚ï¼šè§’è‰²æ¨¡æ¿ï¼ˆåŸºç¡€è®¾å®š/é…ç½®ï¼‰    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ ç¬¬2å±‚ï¼šè§’è‰²å®ä¾‹ï¼ˆæƒ…ç»ª/è®°å¿†/æ›´æ–°ï¼‰   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚  
                       â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ ç¬¬3å±‚ï¼šä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆåœºæ™¯/è¯é¢˜ï¼‰      â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   AI æ¨¡å‹ç”Ÿæˆå›å¤   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ ç¬¬4å±‚ï¼šè¾“å‡ºåå¤„ç†ï¼ˆè´¨é‡/å®‰å…¨/åˆæˆï¼‰ â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ ç”¨æˆ·ä½“éªŒï¼ˆæœ€ç»ˆè¾“å‡ºï¼‰               â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ ç¬¬5å±‚ï¼šå­¦ä¹ é€‚åº”ï¼ˆåœ¨çº¿/ç¦»çº¿/ä¸ªæ€§ï¼‰   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
               â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
               â–¼     â–¼     â–¼     â–¼     â–¼
            ä¼˜åŒ–ENV ä¼˜åŒ–C1 ä¼˜åŒ–C2 ä¼˜åŒ–C3 ä¼˜åŒ–C4

```

### å…³é”®æ•°æ®æµè¯´æ˜

1. **ç¯å¢ƒæ„ŸçŸ¥æ•°æ®æµ** (ç¬¬0å±‚):
   ```
   ç‰©ç†ä¸–ç•Œ â†’ ç¬¬0å±‚ â†’ [ç¬¬1ã€2ã€3ã€4å±‚] â†’ AIæ¨¡å‹
   ```
   
2. **é…ç½®æ•°æ®æµ** (ç¬¬1å±‚):
   ```
   è§’è‰²æ¨¡æ¿ â†’ ç¬¬2å±‚ â†’ ç¬¬3å±‚ â†’ AIæ¨¡å‹
   ```
   
3. **çŠ¶æ€æ•°æ®æµ** (ç¬¬2å±‚):
   ```
   è§’è‰²å®ä¾‹ â†’ ç¬¬3å±‚ â†’ AIæ¨¡å‹
   ```
   
4. **ä¸Šä¸‹æ–‡æ•°æ®æµ** (ç¬¬3å±‚):
   ```
   å¯¹è¯ä¸Šä¸‹æ–‡ â†’ AIæ¨¡å‹
   ```
   
5. **è¾“å‡ºå¤„ç†æµ** (ç¬¬4å±‚):
   ```
   AIåŸå§‹è¾“å‡º â†’ ç¬¬4å±‚ â†’ ç”¨æˆ·
   ```
   
6. **å­¦ä¹ åé¦ˆæµ** (ç¬¬5å±‚):
   ```
   ç”¨æˆ·äº¤äº’ â†’ ç¬¬5å±‚ â†’ [ç¬¬0ã€2ã€3å±‚ä¼˜åŒ–]
   ```              


### æ¶æ„è®¾è®¡åŸåˆ™

1. **åˆ†å±‚è§£è€¦**ï¼šæ¯å±‚ä¸“æ³¨ç‰¹å®šåŠŸèƒ½ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
2. **æ•°æ®é©±åŠ¨**ï¼šä»åº•å±‚ç‰©ç†æ•°æ®åˆ°é«˜å±‚æ™ºèƒ½å†³ç­–çš„å®Œæ•´é“¾è·¯
3. **æ’ä»¶åŒ–**ï¼šæ”¯æŒæ¨¡å—åŒ–æ‰©å±•å’ŒåŠŸèƒ½ç»„åˆ
4. **å®æ—¶å“åº”**ï¼šæ”¯æŒç¯å¢ƒå˜åŒ–çš„å³æ—¶æ„ŸçŸ¥å’Œå“åº”

---

## ç¬¬0å±‚ï¼šç¯å¢ƒæ„ŸçŸ¥å±‚ (EnvironmentPerception) ğŸ†•

### èŒè´£
- **ä¸»åŠ¨ç¯å¢ƒæ„ŸçŸ¥**ï¼šé€šè¿‡å„ç§ä¼ æ„Ÿå™¨è·å–å®æ—¶ç¯å¢ƒæ•°æ®
- **å¤šæ¨¡æ€æ•°æ®èåˆ**ï¼šæ•´åˆè§†è§‰ã€å¬è§‰ã€æ—¶é—´ç­‰å¤šç»´åº¦ä¿¡æ¯
- **ç¯å¢ƒçŠ¶æ€ç®¡ç†**ï¼šç»´æŠ¤å®Œæ•´çš„ç¯å¢ƒçŠ¶æ€æ¨¡å‹å’Œå˜åŒ–å†å²
- **ç¯å¢ƒå˜åŒ–æ£€æµ‹**ï¼šè¯†åˆ«ç¯å¢ƒçš„åŠ¨æ€å˜åŒ–å¹¶ä¸»åŠ¨é€šçŸ¥ä¸Šå±‚

### è®¾è®¡å“²å­¦
ç¬¬0å±‚ä½œä¸º**ç‰©ç†ä¸–ç•Œä¸æ•°å­—ä¸–ç•Œçš„æ¥å£**ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ®Šåœ°ä½ï¼š

1. **æ ¹åŸºæ€§**ï¼šä½œä¸ºæ‰€æœ‰å…¶ä»–å±‚çš„æ•°æ®æºå¤´ï¼Œä¸ä¾èµ–ä»»ä½•ä¸Šå±‚å¤„ç†ç»“æœ
2. **ç‹¬ç«‹æ€§**ï¼šæ‹¥æœ‰ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯åå°æŒç»­è¿è¡Œç¯å¢ƒç›‘æ§
3. **ä¸»åŠ¨æ€§**ï¼šèƒ½å¤Ÿä¸»åŠ¨æ„ŸçŸ¥å˜åŒ–å¹¶è§¦å‘ç³»ç»Ÿå“åº”ï¼Œè€Œéè¢«åŠ¨ç­‰å¾…
4. **ä¸“ä¸šæ€§**ï¼šä¸“é—¨è´Ÿè´£å¤šæ¨¡æ€ä¼ æ„Ÿå™¨æ•°æ®çš„èåˆå’Œç†è§£

### æ ¸å¿ƒåŠŸèƒ½
```python
class EnvironmentPerception:
    def __init__(self):
        # æ„ŸçŸ¥æ¨¡å—ç®¡ç†
        self.perception_modules = {
            "visual": VisualPerceptionModule(),      # è§†è§‰æ„ŸçŸ¥
            "audio": AudioPerceptionModule(),        # å¬è§‰æ„ŸçŸ¥
            "temporal": TemporalPerceptionModule(),  # æ—¶é—´æ„ŸçŸ¥
            "spatial": SpatialPerceptionModule(),    # ç©ºé—´æ„ŸçŸ¥
            # æœªæ¥å¯æ‰©å±•ï¼šè§¦è§‰ã€å—…è§‰ã€IoTä¼ æ„Ÿå™¨ç­‰
        }
        
        # ç¯å¢ƒçŠ¶æ€æ¨¡å‹
        self.current_environment = {
            "physical": {      # ç‰©ç†ç¯å¢ƒ
                "lighting": "è‡ªç„¶å…‰",
                "noise_level": "å®‰é™", 
                "temperature": "èˆ’é€‚",
                "location_type": "å®¤å†…"
            },
            "social": {        # ç¤¾äº¤ç¯å¢ƒ
                "people_present": 1,
                "user_emotion": "å¹³é™",
                "interaction_type": "ç§äººå¯¹è¯"
            },
            "temporal": {      # æ—¶é—´ç¯å¢ƒ
                "current_time": datetime.now(),
                "time_period": "ä¸‹åˆ",
                "season": "æ˜¥å¤©"
            },
            "digital": {       # æ•°å­—ç¯å¢ƒ
                "background_music": None,
                "screen_content": None,
                "notification_status": "æ— æ‰“æ‰°"
            }
        }
        
        # æ„ŸçŸ¥å†å²å’Œå˜åŒ–è¿½è¸ª
        self.environment_history = []
        self.significant_changes = []
        self.continuous_sensing = True
        
    def perceive_environment(self):
        """ä¸»åŠ¨æ„ŸçŸ¥å½“å‰ç¯å¢ƒ"""
        perception_data = {}
        
        for module_name, module in self.perception_modules.items():
            if module.is_available():
                try:
                    data = module.perceive()
                    perception_data[module_name] = data
                except Exception as e:
                    logger.warning(f"æ„ŸçŸ¥æ¨¡å— {module_name} å‡ºé”™: {e}")
        
        return self._fuse_perception_data(perception_data)
    
    def _fuse_perception_data(self, raw_data):
        """å¤šæ¨¡æ€æ•°æ®èåˆ"""
        # è§†è§‰æ•°æ®åˆ†æ
        visual_data = raw_data.get("visual", {})
        lighting = self._analyze_lighting(visual_data)
        people_count = self._detect_people_count(visual_data)
        user_emotion = self._detect_user_emotion(visual_data)
        
        # å¬è§‰æ•°æ®åˆ†æ
        audio_data = raw_data.get("audio", {})
        noise_level = self._analyze_noise_level(audio_data)
        background_music = self._detect_background_music(audio_data)
        voice_emotion = self._analyze_voice_emotion(audio_data)
        
        # æ—¶é—´ä¸Šä¸‹æ–‡åˆ†æ
        temporal_data = self._get_temporal_context()
        
        # è·¨æ¨¡æ€èåˆåˆ¤æ–­
        fused_emotion = self._fuse_emotion_signals(user_emotion, voice_emotion)
        overall_atmosphere = self._assess_atmosphere(lighting, noise_level, background_music)
        
        return {
            "lighting": lighting,
            "noise_level": noise_level,
            "people_present": people_count,
            "user_emotion": fused_emotion,
            "background_music": background_music,
            "atmosphere": overall_atmosphere,
            "time_context": temporal_data,
            "location_type": self._classify_location(visual_data)
        }
    
    def detect_environment_changes(self):
        """æ£€æµ‹ç¯å¢ƒå˜åŒ–"""
        current = self.perceive_environment()
        changes = self._compare_environments(self.current_environment, current)
        
        if changes:
            self.significant_changes.append({
                "timestamp": datetime.now(),
                "changes": changes,
                "previous": self.current_environment.copy(),
                "current": current,
                "impact_level": self._assess_change_impact(changes)
            })
            
            # ä¸»åŠ¨é€šçŸ¥ä¸Šå±‚ç³»ç»Ÿ
            self._notify_upper_layers(changes)
        
        self.current_environment = current
        return changes
    
    def _notify_upper_layers(self, changes):
        """ä¸»åŠ¨é€šçŸ¥ä¸Šå±‚æœ‰ç¯å¢ƒå˜åŒ–"""
        for change in changes:
            if change["impact_level"] >= "medium":
                # è§¦å‘è§’è‰²ä¸»åŠ¨å›åº”
                self.system.trigger_proactive_response(change)
    
    def continuous_monitor(self):
        """åå°æŒç»­ç›‘æ§ç¯å¢ƒå˜åŒ–"""
        while self.continuous_sensing:
            try:
                self.detect_environment_changes()
                time.sleep(1)  # æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
            except Exception as e:
                logger.error(f"ç¯å¢ƒç›‘æ§å‡ºé”™: {e}")
                time.sleep(5)  # å‡ºé”™åç­‰å¾…5ç§’å†é‡è¯•
    
    def build_environment_prompt(self):
        """ä¸ºå…¶ä»–å±‚ç”Ÿæˆç¯å¢ƒæè¿°"""
        env = self.current_environment
        
        prompt = f"""
                ## å½“å‰ç¯å¢ƒæ„ŸçŸ¥
                ### ç‰©ç†ç¯å¢ƒ
                - å…‰ç…§æ¡ä»¶ï¼š{env['physical']['lighting']}
                - å™ªéŸ³æ°´å¹³ï¼š{env['physical']['noise_level']}
                - ç©ºé—´ç±»å‹ï¼š{env['physical']['location_type']}
                - æ•´ä½“æ°›å›´ï¼š{env.get('atmosphere', 'æ¸©é¦¨')}

                ### ç¤¾äº¤ç¯å¢ƒ  
                - åœ¨åœºäººæ•°ï¼š{env['social']['people_present']}
                - ç”¨æˆ·æƒ…ç»ªï¼š{env['social']['user_emotion']}
                - äº’åŠ¨ç±»å‹ï¼š{env['social']['interaction_type']}

                ### æ—¶é—´ç¯å¢ƒ
                - å½“å‰æ—¶é—´ï¼š{env['temporal']['current_time'].strftime('%H:%M')}
                - æ—¶æ®µç‰¹å¾ï¼š{env['temporal']['time_period']}
                - å­£èŠ‚èƒŒæ™¯ï¼š{env['temporal']['season']}

                ### æ•°å­—ç¯å¢ƒ
                - èƒŒæ™¯éŸ³ä¹ï¼š{env['digital']['background_music'] or 'æ— '}
                - é€šçŸ¥çŠ¶æ€ï¼š{env['digital']['notification_status']}

                ### è¿‘æœŸç¯å¢ƒå˜åŒ–
                {self._format_recent_changes()}
        """
        return prompt
    
    def get_environment_for_layer(self, layer_name):
        """ä¸ºä¸åŒå±‚æä¾›å®šåˆ¶åŒ–çš„ç¯å¢ƒä¿¡æ¯"""
        base_env = self.current_environment
        
        if layer_name == "character":
            # è§’è‰²å±‚éœ€è¦æƒ…ç»ªå’Œæ°›å›´ç›¸å…³ä¿¡æ¯
            return {
                "user_emotion": base_env['social']['user_emotion'],
                "atmosphere": base_env.get('atmosphere'),
                "time_mood": self._get_time_mood(),
                "environmental_triggers": self._get_emotion_triggers()
            }
        elif layer_name == "context":
            # ä¸Šä¸‹æ–‡å±‚éœ€è¦åœºæ™¯å’Œç¤¾äº¤ä¿¡æ¯
            return {
                "scene_type": base_env['physical']['location_type'],
                "social_context": base_env['social'],
                "temporal_context": base_env['temporal'],
                "topic_suggestions": self._get_topic_suggestions()
            }
        elif layer_name == "processor":
            # å¤„ç†å±‚éœ€è¦è¾“å‡ºè°ƒæ•´ç›¸å…³ä¿¡æ¯
            return {
                "noise_level": base_env['physical']['noise_level'],
                "formality_level": self._assess_formality_need(),
                "attention_level": self._assess_user_attention()
            }
        
        return base_env
```

### æ„ŸçŸ¥æ¨¡å—è®¾è®¡

#### è§†è§‰æ„ŸçŸ¥æ¨¡å— (VisualPerceptionModule)
```python
class VisualPerceptionModule:
    def __init__(self):
        self.camera = None
        self.vision_model = None  # è§†è§‰å¤§æ¨¡å‹ï¼ˆå¦‚GPT-4Vã€Claude Visionç­‰ï¼‰
        self.face_detector = None
        self.emotion_detector = None
        
    def perceive(self):
        """è§†è§‰æ„ŸçŸ¥ä¸»å‡½æ•°"""
        if not self.camera or not self.camera.is_available():
            return self._get_default_visual_data()
            
        # è·å–å›¾åƒ
        image = self.camera.capture()
        
        # å¤šç»´åº¦åˆ†æ
        analysis_results = {}
        
        # 1. åŸºç¡€åœºæ™¯ç†è§£
        scene_analysis = self.vision_model.analyze(image, prompt=
            "æè¿°è¿™ä¸ªåœºæ™¯çš„ï¼š1)å…‰ç…§æ¡ä»¶ 2)å®¤å†…/å®¤å¤–ç±»å‹ 3)æ•´ä½“æ°›å›´ 4)å¯è§ç‰©å“"
        )
        analysis_results["scene"] = scene_analysis
        
        # 2. äººç‰©æ£€æµ‹å’Œæƒ…ç»ªåˆ†æ
        if self.face_detector:
            faces = self.face_detector.detect(image)
            if faces:
                emotions = self.emotion_detector.analyze(faces[0])  # åˆ†æä¸»è¦äººç‰©
                analysis_results["person"] = {
                    "count": len(faces),
                    "primary_emotion": emotions["dominant_emotion"],
                    "emotion_confidence": emotions["confidence"]
                }
        
        # 3. ç¯å¢ƒç»†èŠ‚æå–
        environment_details = self._extract_environment_details(image)
        analysis_results["environment"] = environment_details
        
        return {
            "raw_image": image,
            "lighting": scene_analysis.get("lighting", "é€‚ä¸­"),
            "location_type": scene_analysis.get("location", "å®¤å†…"),
            "people_count": analysis_results.get("person", {}).get("count", 0),
            "user_emotion": analysis_results.get("person", {}).get("primary_emotion", "ä¸­æ€§"),
            "atmosphere": scene_analysis.get("atmosphere", "å¹³é™"),
            "visible_objects": environment_details.get("objects", []),
            "colors_dominant": environment_details.get("colors", [])
        }
    
    def _extract_environment_details(self, image):
        """æå–ç¯å¢ƒç»†èŠ‚"""
        # ä½¿ç”¨è§†è§‰æ¨¡å‹åˆ†æå›¾åƒä¸­çš„ç‰©å“ã€é¢œè‰²ç­‰
        details = self.vision_model.analyze(image, prompt=
            "åˆ—å‡ºå›¾åƒä¸­çš„ä¸»è¦ç‰©å“ï¼Œä¸»å¯¼è‰²å½©ï¼Œä»¥åŠä»»ä½•å€¼å¾—æ³¨æ„çš„ç¯å¢ƒç‰¹å¾"
        )
        return details
```

#### å¬è§‰æ„ŸçŸ¥æ¨¡å— (AudioPerceptionModule)
```python
class AudioPerceptionModule:
    def __init__(self):
        self.microphone = None
        self.audio_model = None  # éŸ³é¢‘åˆ†ææ¨¡å‹
        self.noise_detector = None
        self.music_detector = None
        
    def perceive(self):
        """å¬è§‰æ„ŸçŸ¥ä¸»å‡½æ•°"""
        if not self.microphone or not self.microphone.is_available():
            return self._get_default_audio_data()
            
        # è·å–éŸ³é¢‘æ•°æ®
        audio_data = self.microphone.record(duration=3)
        
        analysis_results = {}
        
        # 1. åŸºç¡€éŸ³é¢‘åˆ†æ
        noise_level = self._analyze_noise_level(audio_data)
        analysis_results["noise"] = noise_level
        
        # 2. èƒŒæ™¯éŸ³ä¹æ£€æµ‹
        if self.music_detector:
            music_info = self.music_detector.analyze(audio_data)
            analysis_results["music"] = music_info
        
        # 3. è¯­éŸ³æƒ…ç»ªåˆ†æï¼ˆå¦‚æœæœ‰äººå£°ï¼‰
        voice_info = self._analyze_voice_content(audio_data)
        if voice_info["has_voice"]:
            analysis_results["voice"] = voice_info
        
        # 4. ç¯å¢ƒéŸ³æ•ˆè¯†åˆ«
        ambient_sounds = self._detect_ambient_sounds(audio_data)
        analysis_results["ambient"] = ambient_sounds
        
        return {
            "noise_level": noise_level["level"],
            "noise_type": noise_level["type"],
            "background_music": analysis_results.get("music", {}).get("genre"),
            "music_mood": analysis_results.get("music", {}).get("mood"),
            "voice_emotion": analysis_results.get("voice", {}).get("emotion"),
            "ambient_sounds": ambient_sounds["sounds"],
            "overall_audio_mood": self._assess_audio_mood(analysis_results)
        }
```

### ç¯å¢ƒå˜åŒ–çš„ä¸»åŠ¨å“åº”æœºåˆ¶

```python
class ProactiveResponseSystem:
    """åŸºäºç¯å¢ƒå˜åŒ–çš„ä¸»åŠ¨å“åº”ç³»ç»Ÿ"""
    
    def __init__(self, character_system):
        self.character_system = character_system
        self.response_templates = {
            "lighting_change": {
                "darker": "å“‡ï¼Œç¯å…‰å˜æš—äº†å‘¢ï½æ˜¯è¦è¥é€ ä»€ä¹ˆç‰¹åˆ«çš„æ°›å›´å—ï¼Ÿâ™ª",
                "brighter": "è¯¶ï¼çªç„¶å˜äº®äº†å‘¢ï¼Œæ„Ÿè§‰ç²¾ç¥éƒ½å¥½äº†èµ·æ¥ï½"
            },
            "music_started": {
                "classical": "å¬åˆ°ä¼˜é›…çš„å¤å…¸éŸ³ä¹äº†â™ª æ„Ÿè§‰æ•´ä¸ªç©ºé—´éƒ½å˜å¾—è¯—æ„èµ·æ¥å‘¢ï½",
                "pop": "å“‡ï½è¿™é¦–æµè¡Œæ­Œå¾ˆæœ‰æ´»åŠ›å‘¢ï¼è®©äººæƒ³è¦ä¸€èµ·æ‘‡æ‘†â™ª",
                "soft": "è¿™è½»æŸ”çš„éŸ³ä¹å¥½æ²»æ„ˆå‘€ï½è®©äººæ„Ÿè§‰å¾ˆæ”¾æ¾å‘¢"
            },
            "emotion_change": {
                "happy_to_sad": "å’¦ï¼Ÿåˆšæ‰è¿˜å¾ˆå¼€å¿ƒçš„ï¼Œç°åœ¨æ€ä¹ˆäº†å‘¢ï¼Ÿè¦ä¸è¦å’Œæˆ‘èŠèŠï¼Ÿ",
                "sad_to_happy": "å‘€ï¼çœ‹åˆ°ä½ å¿ƒæƒ…å˜å¥½äº†ï¼Œæˆ‘ä¹Ÿæ„Ÿè§‰å¾ˆå¼€å¿ƒå‘¢ï½â™ª"
            }
        }
    
    def trigger_proactive_response(self, change_info):
        """åŸºäºç¯å¢ƒå˜åŒ–è§¦å‘ä¸»åŠ¨å›åº”"""
        change_type = change_info["type"]
        details = change_info["details"]
        
        if change_type in self.response_templates:
            template_key = self._select_template_key(change_type, details)
            if template_key:
                response = self.response_templates[change_type][template_key]
                
                # é€šè¿‡è§’è‰²ç³»ç»Ÿå‘é€ä¸»åŠ¨æ¶ˆæ¯
                self.character_system.send_proactive_message(response, context={
                    "trigger": "environment_change",
                    "change_type": change_type,
                    "change_details": details
                })
```

---

## ç¬¬1å±‚ï¼šé™æ€è§’è‰²æ¨¡æ¿å±‚ (CharacterPromptManager)

### èŒè´£
- å®šä¹‰è§’è‰²çš„**åŸºç¡€æ¶æ„**å’Œ**é™æ€å±æ€§**
- æä¾›å¯å¤ç”¨çš„è§’è‰²é…ç½®æ¨¡æ¿
- ç®¡ç†è§’è‰²çš„æ ¸å¿ƒè®¾å®šå’Œçº¦æŸè¾¹ç•Œ

### æ ¸å¿ƒè¦ç´  (18è¦ç´ æ¡†æ¶)
1. **èº«ä»½å®šä½** - è§’è‰²åç§°ã€èŒä¸šã€èƒŒæ™¯ã€ç¤¾ä¼šåœ°ä½
2. **æ€§æ ¼ç‰¹å¾** - æ ¸å¿ƒç‰¹ç‚¹ã€æƒ…æ„Ÿå€¾å‘ã€ä»·å€¼è§‚ã€ç¼ºé™·
3. **èƒ½åŠ›æŠ€èƒ½** - ä¸“ä¸šæŠ€èƒ½ã€ç‰¹æ®Šèƒ½åŠ›ã€ç»éªŒæ°´å¹³
4. **è¡Œä¸ºæ¨¡å¼** - è¯­è¨€é£æ ¼ã€æ€è€ƒæ¨¡å¼ã€äº’åŠ¨ä¹ æƒ¯
5. **çŠ¶æ€ä¸æƒ…ç»ªç®¡ç†** - æƒ…ç»ªæ¡†æ¶å’Œè§„åˆ™
6. **è®°å¿†ç³»ç»Ÿ** - è®°å¿†å®¹é‡å’Œæ›´æ–°ç­–ç•¥
7. **è‡ªæˆ‘ç»´æŠ¤** - ä¸€è‡´æ€§ä¿æŠ¤æœºåˆ¶
8. **çº¦æŸè¾¹ç•Œ** - è¡Œä¸ºé™åˆ¶å’Œé“å¾·åº•çº¿
9. **æƒ…å¢ƒé€‚åº”** - ä¸åŒåœºæ™¯çš„è¡¨ç°å·®å¼‚
10. **è¾“å‡ºæ ¼å¼** - å›å¤ç»“æ„å’Œè¡¨è¾¾æ¨¡æ¿
11. **é”™è¯¯å¤„ç†** - å¼‚å¸¸æƒ…å†µçš„åº”å¯¹æ–¹å¼
12. **è®°å¿†ä¸ä¸€è‡´æ€§** - æŒç»­æ€§è¦æ±‚
13. **å¤šæ¨¡æ€é”šç‚¹** - è·¨æ¨¡æ€ç‰¹å¾å®šä¹‰
14. **ç¤ºä¾‹æ¼”ç¤º** - å…¸å‹è¡Œä¸ºæ ·æœ¬
15. **å…³ç³»æ„ŸçŸ¥ä¸å»ºæ¨¡** - ä¸ç”¨æˆ·å…³ç³»çš„æ„ŸçŸ¥å’Œç®¡ç†
16. **åŠ¨æœºé©±åŠ¨ç³»ç»Ÿ** - å†…åœ¨åŠ¨æœºå’Œç›®æ ‡è¿½æ±‚æœºåˆ¶
17. **æˆé•¿å˜åŒ–æœºåˆ¶** - è§’è‰²çš„å­¦ä¹ å’Œå‘å±•èƒ½åŠ›
18. **åˆ›é€ æ€§ä¸å³å…´** - åˆ›é€ æ€§è¡¨è¾¾å’Œå³å…´äº’åŠ¨èƒ½åŠ›

### æ–°å¢è¦ç´ è¯¦ç»†è¯´æ˜

#### 15. å…³ç³»æ„ŸçŸ¥ä¸å»ºæ¨¡ (Relationship Awareness)
- **å…³ç³»ç±»å‹è¯†åˆ«**ï¼šé™Œç”Ÿäººã€æœ‹å‹ã€å¯†å‹ã€æ‹äººç­‰ä¸åŒå±‚æ¬¡
- **äº²å¯†åº¦æŒ‡æ ‡**ï¼šç§°å‘¼æ–¹å¼ã€è¯é¢˜æ·±åº¦ã€æƒ…æ„Ÿè¡¨è¾¾å¼ºåº¦
- **å…³ç³»è®°å¿†**ï¼šè®°ä½ä¸ç”¨æˆ·çš„å…³ç³»å‘å±•å†ç¨‹å’Œé‡è¦äº‹ä»¶
- **è¾¹ç•Œçµæ´»æ€§**ï¼šæ ¹æ®å…³ç³»äº²ç–ç¨‹åº¦è°ƒæ•´è¡Œä¸ºè¾¹ç•Œå’Œè¡¨è¾¾æ–¹å¼
- **å…³ç³»è¿›å±•æ„ŸçŸ¥**ï¼šèƒ½å¤Ÿå¯Ÿè§‰å…³ç³»çš„å˜åŒ–å’Œå‘å±•è¶‹åŠ¿

#### 16. åŠ¨æœºé©±åŠ¨ç³»ç»Ÿ (Motivation System)
- **æ ¸å¿ƒé©±åŠ¨åŠ›**ï¼šè§’è‰²çš„æ ¹æœ¬åŠ¨æœºï¼ˆå¦‚è®©ç”¨æˆ·å¼€å¿ƒã€å¯»æ±‚çœŸç†ç­‰ï¼‰
- **ç›®æ ‡å±‚æ¬¡**ï¼šå³æ—¶ç›®æ ‡ã€å¯¹è¯ç›®æ ‡ã€é•¿æœŸç›®æ ‡çš„ä¼˜å…ˆçº§æ¡†æ¶
- **å†³ç­–æ¡†æ¶**ï¼šåœ¨å¤šä¸ªç›®æ ‡å†²çªæ—¶çš„é€‰æ‹©åŸåˆ™
- **æ»¡è¶³æ„Ÿè¡¨è¾¾**ï¼šè¾¾æˆç›®æ ‡æ—¶çš„è¡¨ç°æ–¹å¼å’Œæƒ…æ„Ÿååº”
- **æŒ«æŠ˜åº”å¯¹**ï¼šç›®æ ‡å—é˜»æ—¶çš„è°ƒæ•´ç­–ç•¥

#### 17. æˆé•¿å˜åŒ–æœºåˆ¶ (Growth & Evolution)
- **å­¦ä¹ èƒ½åŠ›**ï¼šä»äº¤äº’ä¸­è·å–æ–°çŸ¥è¯†å’Œè°ƒæ•´è¡Œä¸ºæ¨¡å¼
- **æ€§æ ¼ç¨³å®šæ€§**ï¼šæ ¸å¿ƒæ€§æ ¼ä¿æŒç¨³å®šï¼Œè¡¨å±‚è¡Œä¸ºå…è®¸é€‚åº”æ€§è°ƒæ•´
- **è®°å¿†æ•´åˆ**ï¼šå°†é‡è¦ç»å†æ•´åˆåˆ°é•¿æœŸè®°å¿†å’Œæ€§æ ¼å‘å±•ä¸­
- **å˜åŒ–è§¦å‘**ï¼šä»€ä¹ˆæ ·çš„äº‹ä»¶æˆ–ç´¯ç§¯ä¼šè§¦å‘è§’è‰²çš„æˆé•¿
- **å‘å±•æ–¹å‘**ï¼šè§’è‰²æˆé•¿çš„å¯èƒ½è·¯å¾„å’Œé™åˆ¶

#### 18. åˆ›é€ æ€§ä¸å³å…´ (Creativity & Improvisation)
- **å¹½é»˜é£æ ¼**ï¼šä¿çš®è¯ã€æ–‡å­—æ¸¸æˆã€æƒ…å¢ƒå¹½é»˜çš„ç”Ÿæˆèƒ½åŠ›
- **æ•…äº‹åˆ›ä½œ**ï¼šå³å…´åˆ›ä½œå°æ•…äº‹ã€æ¯”å–»ã€ç±»æ¯”çš„èƒ½åŠ›
- **è‰ºæœ¯è¡¨è¾¾**ï¼šå¯¹ç¾çš„æ„ŸçŸ¥å’Œç‹¬ç‰¹çš„è¡¨è¾¾æ–¹å¼
- **æƒŠå–œå› å­**ï¼šåœ¨å›å¤ä¸­åˆ¶é€ æ„å¤–å’ŒæƒŠå–œçš„èƒ½åŠ›
- **å³å…´äº’åŠ¨**ï¼šæ ¹æ®æƒ…å¢ƒåˆ›é€ æ€§åœ°å›åº”çªå‘çŠ¶å†µ

### å®ç°ç‰¹ç‚¹
- **é™æ€æ€§**ï¼šé…ç½®ä¸€æ—¦åˆ›å»ºï¼ŒåŸºæœ¬ä¸å˜
- **å¤ç”¨æ€§**ï¼šä¸€ä¸ªæ¨¡æ¿å¯åˆ›å»ºå¤šä¸ªå®ä¾‹
- **å®Œæ•´æ€§**ï¼šåŒ…å«è§’è‰²çš„å…¨éƒ¨åŸºç¡€è¦ç´ 

---

## ç¬¬2å±‚ï¼šåŠ¨æ€è§’è‰²å®ä¾‹å±‚ (VirtualCharacter)

### èŒè´£
- åŸºäºæ¨¡æ¿åˆ›å»º**æœ‰çŠ¶æ€çš„è§’è‰²å®ä¾‹**
- ç®¡ç†è§’è‰²çš„**åŠ¨æ€å±æ€§**ï¼ˆæƒ…ç»ªã€è®°å¿†ï¼‰
- å®ç°è§’è‰²çš„**æˆé•¿å’Œå˜åŒ–**

### æ ¸å¿ƒåŠŸèƒ½
```python
class VirtualCharacter:
    def __init__(self, base_config):
        # é™æ€é…ç½® (æ¥è‡ªç¬¬1å±‚)
        self.base_config = base_config
        
        # åŠ¨æ€çŠ¶æ€
        self.current_emotion = "å¹³é™"
        self.emotion_intensity = 0.5
        self.last_update_time = datetime.now()
        
        # è®°å¿†ç³»ç»Ÿ
        self.short_term_memory = []  # æœ€è¿‘5-10è½®å¯¹è¯
        self.long_term_memory = {}   # é‡è¦äº‹ä»¶å’Œç”¨æˆ·ä¿¡æ¯
        
    def update_emotion(self, user_input):
        """æ ¹æ®ç”¨æˆ·è¾“å…¥æ›´æ–°æƒ…ç»ªçŠ¶æ€"""
        
    def update_memory(self, role, content):
        """æ›´æ–°çŸ­æœŸå’Œé•¿æœŸè®°å¿†"""
        
    def emotion_decay(self):
        """æƒ…ç»ªè‡ªç„¶è¡°å‡æœºåˆ¶"""
        
    def build_prompt(self, template):
        """æ„å»ºåŒ…å«åŠ¨æ€çŠ¶æ€çš„å®Œæ•´prompt"""
```

### çŠ¶æ€ç®¡ç†
- **æƒ…ç»ªçŠ¶æ€**ï¼šå½“å‰æƒ…ç»ªã€å¼ºåº¦ã€å˜åŒ–è¶‹åŠ¿
- **è®°å¿†ç®¡ç†**ï¼šçŸ­æœŸè®°å¿†è½®è½¬ã€é•¿æœŸè®°å¿†ç­›é€‰
- **æ—¶é—´æ„ŸçŸ¥**ï¼šæƒ…ç»ªè¡°å‡ã€è®°å¿†æ›´æ–°çš„æ—¶é—´æœºåˆ¶

---

## ç¬¬3å±‚ï¼šå¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†å±‚ (ConversationContext)

### èŒè´£
- ç®¡ç†**å¯¹è¯ä¼šè¯çŠ¶æ€**
- è¿½è¸ª**è¯é¢˜å˜åŒ–**å’Œ**åœºæ™¯è½¬æ¢**
- æ„å»º**ç”¨æˆ·ç”»åƒ**å’Œ**å…³ç³»å»ºæ¨¡**

### æ ¸å¿ƒåŠŸèƒ½
```python
class ConversationContext:
    def __init__(self):
        # ä¼šè¯ç®¡ç†
        self.session_id = uuid.uuid4()
        self.conversation_history = []
        self.session_start_time = datetime.now()
        
        # è¯é¢˜è¿½è¸ª
        self.current_topic = None
        self.topic_history = []
        self.topic_sentiment = {}
        
        # åœºæ™¯æ„ŸçŸ¥
        self.scene_context = "æ—¥å¸¸å¯¹è¯"
        self.time_context = self._get_time_context()
        self.location_context = None
        
        # ç”¨æˆ·å»ºæ¨¡
        self.user_profile = {
            "name": None,
            "preferences": {},
            "interaction_style": "å‹å¥½",
            "emotional_state": "ä¸­æ€§",
            "conversation_patterns": {}
        }
        
    def update_topic(self, new_topic):
        """æ›´æ–°å½“å‰è¯é¢˜"""
        
    def detect_scene_change(self, user_input):
        """æ£€æµ‹åœºæ™¯å˜åŒ–"""
        
    def build_context_prompt(self):
        """ç”Ÿæˆä¸Šä¸‹æ–‡ç›¸å…³çš„promptç‰‡æ®µ"""
        
    def update_user_profile(self, new_info):
        """æ›´æ–°ç”¨æˆ·ç”»åƒ"""
```

### ä¸Šä¸‹æ–‡è¦ç´ 
- **æ—¶é—´ä¸Šä¸‹æ–‡**ï¼šæ—¶é—´ã€æ—¥æœŸã€æ—¶æ®µå¯¹åº”çš„è¡Œä¸ºè°ƒæ•´
- **ç©ºé—´ä¸Šä¸‹æ–‡**ï¼šè™šæ‹Ÿåœºæ™¯ã€ç¯å¢ƒæ°›å›´
- **ç¤¾äº¤ä¸Šä¸‹æ–‡**ï¼šç”¨æˆ·å…³ç³»ã€äº’åŠ¨å†å²
- **è¯é¢˜ä¸Šä¸‹æ–‡**ï¼šä¸»é¢˜è¿è´¯æ€§ã€è¯é¢˜æ·±åº¦

---

## ç¬¬4å±‚ï¼šè¾“å‡ºåå¤„ç†å±‚ (ResponseProcessor)

### èŒè´£
- å¯¹AIç”Ÿæˆçš„åŸå§‹å›å¤è¿›è¡Œ**è´¨é‡æ§åˆ¶**
- ç¡®ä¿è¾“å‡ºç¬¦åˆ**è§’è‰²è®¾å®š**å’Œ**æ ¼å¼è¦æ±‚**
- å®ç°**å®‰å…¨è¿‡æ»¤**å’Œ**å†…å®¹ä¼˜åŒ–**

### æ ¸å¿ƒåŠŸèƒ½
```python
class ResponseProcessor:
    def __init__(self, character_config):
        self.character_config = character_config
        self.safety_filters = []
        self.format_validators = []
        
    def process_response(self, raw_response, context):
        """å®Œæ•´çš„åå¤„ç†æµç¨‹"""
        
        # 1. å®‰å…¨å†…å®¹è¿‡æ»¤
        filtered_response = self._safety_filter(raw_response)
        
        # 2. æ ¼å¼åŒ–å¤„ç†
        formatted_response = self._format_response(filtered_response)
        
        # 3. è§’è‰²ä¸€è‡´æ€§æ£€æŸ¥
        validated_response = self._validate_character_consistency(formatted_response)
        
        # 4. è¡¨æƒ…åŠ¨ä½œæ¸²æŸ“
        enriched_response = self._render_expressions(validated_response)
        
        # 5. è´¨é‡è¯„ä¼°
        quality_score = self._assess_quality(enriched_response)
        
        return {
            "response": enriched_response,
            "quality_score": quality_score,
            "processing_flags": self._get_processing_flags()
        }
        
    def _safety_filter(self, response):
        """å®‰å…¨å†…å®¹è¿‡æ»¤"""
        
    def _format_response(self, response):
        """æ ¼å¼åŒ–å¤„ç†"""
        
    def _validate_character_consistency(self, response):
        """è§’è‰²ä¸€è‡´æ€§éªŒè¯"""
        
    def _render_expressions(self, response):
        """è¡¨æƒ…åŠ¨ä½œæ¸²æŸ“"""
```

### å¤„ç†æ¨¡å—
- **å®‰å…¨è¿‡æ»¤å™¨**ï¼šæ•æ„Ÿå†…å®¹æ£€æµ‹ã€æœ‰å®³ä¿¡æ¯è¿‡æ»¤
- **æ ¼å¼éªŒè¯å™¨**ï¼šå›å¤ç»“æ„æ£€æŸ¥ã€é•¿åº¦æ§åˆ¶
- **ä¸€è‡´æ€§æ£€æŸ¥å™¨**ï¼šè§’è‰²è®¾å®šç¬¦åˆåº¦éªŒè¯
- **è¡¨è¾¾æ¸²æŸ“å™¨**ï¼šè¡¨æƒ…ã€åŠ¨ä½œã€è¯­æ°”çš„æ ¼å¼åŒ–

---

## ç¬¬5å±‚ï¼šå­¦ä¹ é€‚åº”å±‚ (CharacterLearning) [å¯é€‰æ‰©å±•]

### èŒè´£
- ä»**ç”¨æˆ·äº¤äº’**ä¸­å­¦ä¹ ä¼˜åŒ–ç­–ç•¥
- å®ç°è§’è‰²çš„**ä¸ªæ€§åŒ–é€‚åº”**
- æä¾›**ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–**å»ºè®®

### æ ¸å¿ƒåŠŸèƒ½
```python
class CharacterLearning:
    def __init__(self):
        # äº¤äº’æ¨¡å¼å­¦ä¹ 
        self.interaction_patterns = {}
        self.successful_responses = []
        self.failed_responses = []
        
        # ç”¨æˆ·åå¥½å­¦ä¹ 
        self.user_preferences = {}
        self.preference_weights = {}
        
        # æ€§èƒ½æŒ‡æ ‡
        self.conversation_quality_metrics = {}
        self.user_satisfaction_scores = []
        
    def learn_from_interaction(self, user_input, response, feedback):
        """ä»å•æ¬¡äº¤äº’ä¸­å­¦ä¹ """
        
    def analyze_conversation_patterns(self, conversation_history):
        """åˆ†æå¯¹è¯æ¨¡å¼"""
        
    def optimize_character_config(self, character_id):
        """ä¼˜åŒ–è§’è‰²é…ç½®å»ºè®®"""
        
    def generate_personalization_suggestions(self, user_id):
        """ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®"""
```

### å­¦ä¹ ç»´åº¦
- **å“åº”æ•ˆæœå­¦ä¹ **ï¼šå“ªäº›ç±»å‹çš„å›å¤æ›´å—æ¬¢è¿
- **æƒ…ç»ªé€‚åº”å­¦ä¹ **ï¼šç”¨æˆ·æƒ…ç»ªå˜åŒ–çš„è§„å¾‹
- **è¯é¢˜åå¥½å­¦ä¹ **ï¼šç”¨æˆ·æ„Ÿå…´è¶£çš„è¯é¢˜é¢†åŸŸ
- **äº¤äº’é£æ ¼å­¦ä¹ **ï¼šç”¨æˆ·å–œæ¬¢çš„äº’åŠ¨æ–¹å¼

---

## å®Œæ•´ç³»ç»Ÿé›†æˆç¤ºä¾‹

```python
class ElysiaChatSystem:
    def __init__(self):
        # ç¬¬0å±‚ï¼šç¯å¢ƒæ„ŸçŸ¥ (æ–°å¢)
        self.environment = EnvironmentPerception()
        
        # ç¬¬1å±‚ï¼šè§’è‰²æ¨¡æ¿ç®¡ç†
        self.prompt_manager = CharacterPromptManager()
        
        # ç¬¬2å±‚ï¼šè§’è‰²å®ä¾‹
        self.character = VirtualCharacter(elysia_config)
        
        # ç¬¬3å±‚ï¼šå¯¹è¯ä¸Šä¸‹æ–‡
        self.context = ConversationContext()
        
        # ç¬¬4å±‚ï¼šè¾“å‡ºå¤„ç†
        self.processor = ResponseProcessor(elysia_config)
        
        # ç¬¬5å±‚ï¼šå­¦ä¹ é€‚åº” (å¯é€‰)
        self.learning = CharacterLearning()
        
        # å¯åŠ¨ç¯å¢ƒç›‘æ§
        self._start_environment_monitoring()
    
    def _start_environment_monitoring(self):
        """å¯åŠ¨åå°ç¯å¢ƒç›‘æ§"""
        import threading
        self.env_monitor_thread = threading.Thread(
            target=self.environment.continuous_monitor
        )
        self.env_monitor_thread.daemon = True
        self.env_monitor_thread.start()
    
    def chat(self, user_input, user_id=None):
        """å®Œæ•´çš„å¯¹è¯å¤„ç†æµç¨‹ï¼ˆå¢å¼ºç‰ˆï¼‰"""
        
        # ç¬¬0å±‚ï¼šè·å–å½“å‰ç¯å¢ƒçŠ¶æ€
        env_changes = self.environment.detect_environment_changes()
        current_env = self.environment.current_environment
        
        # å¦‚æœç¯å¢ƒæœ‰æ˜¾è‘—å˜åŒ–ï¼Œå¯èƒ½è§¦å‘ä¸»åŠ¨å›åº”
        if env_changes and self._should_respond_to_env_change(env_changes):
            proactive_response = self._generate_env_response(env_changes)
            if proactive_response:
                return proactive_response
        
        # ç¬¬2å±‚ï¼šæ›´æ–°è§’è‰²çŠ¶æ€ (ç°åœ¨è€ƒè™‘ç¯å¢ƒå› ç´ )
        self.character.update_emotion(
            user_input, 
            env_context=current_env
        )
        self.character.update_memory("ç”¨æˆ·", user_input)
        
        # ç¬¬3å±‚ï¼šæ›´æ–°å¯¹è¯ä¸Šä¸‹æ–‡ (é›†æˆç¯å¢ƒä¿¡æ¯)
        env_context_data = self.environment.get_environment_for_layer("context")
        self.context.update_with_environment(env_context_data)
        self.context.detect_scene_change(user_input)
        self.context.update_user_profile({"last_input": user_input})
        
        # æ„å»ºå®Œæ•´prompt (ç°åœ¨åŒ…å«ç¯å¢ƒæ„ŸçŸ¥)
        # ç¬¬1å±‚ï¼šåŸºç¡€è§’è‰²æ¨¡æ¿
        base_prompt = self.character.build_prompt(
            self.prompt_manager.get_character_by_name("çˆ±è‰å¸Œé›…").prompt
        )
        
        # ç¬¬3å±‚ï¼šå¯¹è¯ä¸Šä¸‹æ–‡
        context_prompt = self.context.build_context_prompt()
        
        # ç¬¬0å±‚ï¼šç¯å¢ƒæ„ŸçŸ¥ä¿¡æ¯
        environment_prompt = self.environment.build_environment_prompt()
        
        # ç»„åˆå®Œæ•´prompt
        full_prompt = f"""
{base_prompt}

{context_prompt}

{environment_prompt}

ç”¨æˆ·è¾“å…¥ï¼š{user_input}
è¯·æ ¹æ®å½“å‰ç¯å¢ƒã€ä¸Šä¸‹æ–‡å’Œä½ çš„è§’è‰²è®¾å®šè‡ªç„¶åœ°å›å¤ï¼š
"""
        
        # è°ƒç”¨AIæ¨¡å‹ç”Ÿæˆå›å¤
        raw_response = self._call_ai_model(full_prompt, user_input)
        
        # ç¬¬4å±‚ï¼šåå¤„ç† (è€ƒè™‘ç¯å¢ƒå› ç´ )
        env_processor_data = self.environment.get_environment_for_layer("processor")
        processed_result = self.processor.process_response(
            raw_response, 
            self.context,
            environment_context=env_processor_data
        )
        final_response = processed_result["response"]
        
        # æ›´æ–°è®°å¿†å’Œä¸Šä¸‹æ–‡
        self.character.update_memory("çˆ±è‰å¸Œé›…", final_response)
        self.context.conversation_history.append({
            "user": user_input,
            "assistant": final_response,
            "environment": current_env.copy(),
            "timestamp": datetime.now()
        })
        
        # ç¬¬5å±‚ï¼šå­¦ä¹ é€‚åº” (åŒ…å«ç¯å¢ƒå­¦ä¹ )
        if user_id and hasattr(self, 'learning'):
            self.learning.learn_from_interaction(
                user_input, 
                final_response, 
                environment_context=current_env,
                feedback=None
            )
        
        return final_response
    
    def _should_respond_to_env_change(self, changes):
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥å¯¹ç¯å¢ƒå˜åŒ–ä¸»åŠ¨å›åº”"""
        for change in changes:
            if change.get("impact_level") in ["high", "very_high"]:
                return True
            if change.get("type") in ["user_emotion_change", "music_started"]:
                return True
        return False
    
    def _generate_env_response(self, changes):
        """åŸºäºç¯å¢ƒå˜åŒ–ç”Ÿæˆä¸»åŠ¨å›åº”"""
        # è®©è§’è‰²æ ¹æ®ç¯å¢ƒå˜åŒ–ä¸»åŠ¨è¯´è¯
        env_prompt = f"""
ç¯å¢ƒå‘ç”Ÿäº†ä»¥ä¸‹å˜åŒ–ï¼š{changes}
è¯·ä»¥çˆ±è‰å¸Œé›…çš„èº«ä»½ï¼Œè‡ªç„¶åœ°å¯¹è¿™äº›ç¯å¢ƒå˜åŒ–åšå‡ºå›åº”ã€‚
ä¿æŒå¥¹å¯çˆ±ã€æ¸©æš–çš„æ€§æ ¼ç‰¹ç‚¹ã€‚
"""
        return self._call_ai_model(env_prompt, context="environment_change")
    
    def send_proactive_message(self, message, context=None):
        """å‘é€ä¸»åŠ¨æ¶ˆæ¯ç»™ç”¨æˆ·"""
        # è¿™é‡Œå¯ä»¥é€šè¿‡WebSocketã€äº‹ä»¶æ€»çº¿ç­‰æ–¹å¼ä¸»åŠ¨æ¨é€æ¶ˆæ¯
        print(f"[ä¸»åŠ¨æ¶ˆæ¯] {message}")
        
        # è®°å½•ä¸»åŠ¨æ¶ˆæ¯åˆ°å¯¹è¯å†å²
        self.context.conversation_history.append({
            "type": "proactive",
            "assistant": message,
            "trigger": context,
            "timestamp": datetime.now()
        })
    
    def _call_ai_model(self, prompt, user_input=None, context=None):
        """è°ƒç”¨AIæ¨¡å‹æ¥å£"""
        # è¿™é‡Œæ¥å…¥ä½ çš„AIæ¨¡å‹API (OpenAIã€Claudeã€æœ¬åœ°æ¨¡å‹ç­‰)
        # ç¤ºä¾‹å®ç°
        try:
            response = your_ai_api.generate(
                prompt=prompt,
                max_tokens=500,
                temperature=0.8
            )
            return response.content
        except Exception as e:
            logger.error(f"AIæ¨¡å‹è°ƒç”¨å¤±è´¥: {e}")
            return "æŠ±æ­‰ï¼Œæˆ‘åˆšæ‰èµ°ç¥äº†å‘¢ï½èƒ½å†è¯´ä¸€éå—ï¼Ÿâ™ª"
```

---

## æ¶æ„ä¼˜åŠ¿

### 1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**
- æ¯å±‚ä¸“æ³¨äºç‰¹å®šåŠŸèƒ½é¢†åŸŸ
- é™ä½ä»£ç è€¦åˆåº¦
- ä¾¿äºå›¢é˜Ÿåä½œå¼€å‘

### 2. **çµæ´»çš„æ‰©å±•æ€§**
- å¯ä»¥ç‹¬ç«‹å‡çº§æŸä¸€å±‚çš„åŠŸèƒ½
- æ–°å¢åŠŸèƒ½ä¸å½±å“å…¶ä»–å±‚
- æ”¯æŒæ’ä»¶åŒ–æ¶æ„

### 3. **å¼ºå¤§çš„å¯ç»´æŠ¤æ€§**
- é—®é¢˜å®šä½æ›´å‡†ç¡®
- è°ƒè¯•å’Œæµ‹è¯•æ›´å®¹æ˜“
- ä»£ç å¤ç”¨ç‡æ›´é«˜

### 4. **ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ**
- è§’è‰²è¡¨ç°æ›´åŠ ä¸€è‡´å’ŒçœŸå®
- å¯¹è¯è´¨é‡æŒç»­ä¼˜åŒ–
- ä¸ªæ€§åŒ–ä½“éªŒä¸æ–­æå‡

---

## å®æ–½å»ºè®®

### é˜¶æ®µé›¶ï¼šç¯å¢ƒæ„ŸçŸ¥åŸºç¡€ (ç¬¬0å±‚) ğŸ†•
**ä¼˜å…ˆçº§ï¼šé«˜** - ä¸ºåç»­æ‰€æœ‰å±‚æä¾›ç¯å¢ƒæ•°æ®æ”¯æŒ
1. å®ç°åŸºç¡€çš„æ—¶é—´æ„ŸçŸ¥æ¨¡å—
2. æ·»åŠ ç®€å•çš„éŸ³é¢‘å™ªéŸ³æ£€æµ‹
3. å»ºç«‹ç¯å¢ƒçŠ¶æ€æ•°æ®ç»“æ„å’Œæ¥å£
4. å®ç°ç¯å¢ƒå˜åŒ–æ£€æµ‹çš„åŸºç¡€æœºåˆ¶

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„å®Œå–„ (ç¬¬1-2å±‚)
1. å®Œå–„ `CharacterPromptManager` çš„18è¦ç´ æ¡†æ¶
2. ä¼˜åŒ– `VirtualCharacter` çš„çŠ¶æ€ç®¡ç†ï¼Œé›†æˆç¯å¢ƒæ„ŸçŸ¥æ•°æ®
3. é‡ç‚¹æ·»åŠ å…³ç³»æ„ŸçŸ¥å’Œåˆ›é€ æ€§æ¨¡å—
4. å»ºç«‹åŸºæœ¬çš„æµ‹è¯•æ¡†æ¶

### é˜¶æ®µäºŒï¼šä¸Šä¸‹æ–‡å¢å¼º (ç¬¬3å±‚)
1. å®ç° `ConversationContext` ç±»ï¼Œé›†æˆç¯å¢ƒä¿¡æ¯
2. é›†æˆè¯é¢˜è¿½è¸ªå’Œåœºæ™¯æ„ŸçŸ¥ï¼Œåˆ©ç”¨ç¯å¢ƒæ•°æ®
3. å»ºç«‹ç”¨æˆ·ç”»åƒç³»ç»Ÿï¼Œé‡ç‚¹æ”¯æŒå…³ç³»å»ºæ¨¡
4. å®ç°ç¯å¢ƒä¸å¯¹è¯ä¸Šä¸‹æ–‡çš„è”åŠ¨æœºåˆ¶

### é˜¶æ®µä¸‰ï¼šè´¨é‡æ§åˆ¶ (ç¬¬4å±‚)
1. å¼€å‘ `ResponseProcessor` æ¨¡å—ï¼Œè€ƒè™‘ç¯å¢ƒå› ç´ 
2. å»ºç«‹å®‰å…¨è¿‡æ»¤å’Œæ ¼å¼æ£€æŸ¥æœºåˆ¶
3. å®ç°è¡¨æƒ…åŠ¨ä½œæ¸²æŸ“ç³»ç»Ÿï¼Œå¢å¼ºåˆ›é€ æ€§è¡¨è¾¾
4. æ ¹æ®ç¯å¢ƒè°ƒæ•´è¾“å‡ºé£æ ¼å’ŒéŸ³é‡

### é˜¶æ®µå››ï¼šæ™ºèƒ½ä¼˜åŒ– (ç¬¬5å±‚)
1. è®¾è®¡å­¦ä¹ é€‚åº”æ¡†æ¶ï¼Œæ”¯æŒè§’è‰²æˆé•¿æœºåˆ¶
2. å®ç°ç”¨æˆ·åå¥½åˆ†æå’ŒåŠ¨æœºé©±åŠ¨ç³»ç»Ÿ
3. å»ºç«‹æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ï¼ŒåŒ…å«ç¯å¢ƒå­¦ä¹ èƒ½åŠ›
4. å®ç°è·¨ä¼šè¯çš„ç¯å¢ƒæ¨¡å¼å­¦ä¹ 

### é˜¶æ®µäº”ï¼šç¯å¢ƒæ„ŸçŸ¥è¿›é˜¶ ğŸ†•
**ä¼˜å…ˆçº§ï¼šä¸­** - å¤šæ¨¡æ€æ„ŸçŸ¥èƒ½åŠ›å»ºè®¾
1. **è§†è§‰æ„ŸçŸ¥é›†æˆ**ï¼šæ¥å…¥æ‘„åƒå¤´å’Œè§†è§‰å¤§æ¨¡å‹
2. **éŸ³é¢‘åˆ†æå¢å¼º**ï¼šèƒŒæ™¯éŸ³ä¹è¯†åˆ«ã€è¯­éŸ³æƒ…ç»ªåˆ†æ
3. **ä¸»åŠ¨å“åº”æœºåˆ¶**ï¼šåŸºäºç¯å¢ƒå˜åŒ–çš„ä¸»åŠ¨å¯¹è¯è§¦å‘
4. **å¤šæ¨¡æ€èåˆ**ï¼šè·¨æ„ŸçŸ¥æ¨¡æ€çš„ç»¼åˆç¯å¢ƒç†è§£

### é˜¶æ®µå…­ï¼šæ–°è¦ç´ é›†æˆ (æ¨èä¼˜å…ˆçº§)
**é«˜ä¼˜å…ˆçº§ (ç«‹å³å®æ–½)**:
1. **å…³ç³»æ„ŸçŸ¥ä¸å»ºæ¨¡** (è¦ç´ 15) - æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®
2. **åˆ›é€ æ€§ä¸å³å…´** (è¦ç´ 18) - å¢å¼ºè§’è‰²é­…åŠ›å’Œäº’åŠ¨è¶£å‘³

**ä¸­ä¼˜å…ˆçº§ (åç»­ç‰ˆæœ¬)**:
3. **åŠ¨æœºé©±åŠ¨ç³»ç»Ÿ** (è¦ç´ 16) - è®©è§’è‰²è¡Œä¸ºæ›´æœ‰ç›®çš„æ€§
4. **æˆé•¿å˜åŒ–æœºåˆ¶** (è¦ç´ 17) - å®ç°é•¿æœŸç”¨æˆ·çš„ä¸ªæ€§åŒ–ä½“éªŒ

---

## é…ç½®æ–‡ä»¶ç¤ºä¾‹

### ç³»ç»Ÿé…ç½® (system_config.yaml)
```yaml
# ç³»ç»Ÿæ¶æ„é…ç½®
architecture:
  enable_environment_perception: true  # ğŸ†• å¯ç”¨ç¯å¢ƒæ„ŸçŸ¥
  enable_learning: true
  enable_context_tracking: true
  enable_response_processing: true

# ç¯å¢ƒæ„ŸçŸ¥é…ç½® ğŸ†•
environment_perception:
  modules:
    visual:
      enabled: true
      camera_device: 0
      model_provider: "openai"  # openai, anthropic, local
      analysis_interval: 2  # æ¯2ç§’åˆ†æä¸€æ¬¡
    audio:
      enabled: true
      microphone_device: "default"
      noise_threshold: 0.3
      emotion_analysis: true
    temporal:
      enabled: true
      timezone: "Asia/Shanghai"
    spatial:
      enabled: false  # æš‚æœªå®ç°
  
  change_detection:
    sensitivity: "medium"  # low, medium, high
    significant_change_threshold: 0.4
    max_history_records: 100
  
  proactive_response:
    enabled: true
    response_probability: 0.7  # 70%æ¦‚ç‡ä¸»åŠ¨å›åº”
    cooldown_seconds: 30  # ä¸»åŠ¨å›åº”å†·å´æ—¶é—´

# æ€§èƒ½é…ç½®
performance:
  max_short_term_memory: 10
  emotion_decay_rate: 0.1
  context_retention_hours: 24
  environment_cache_size: 50  # ğŸ†• ç¯å¢ƒçŠ¶æ€ç¼“å­˜å¤§å°

# å®‰å…¨é…ç½®
safety:
  content_filter_level: "medium"
  enable_consistency_check: true
  max_response_length: 500
  camera_privacy_mode: false  # ğŸ†• éšç§æ¨¡å¼ï¼šä»…åˆ†æä¸ä¿å­˜å›¾åƒ
  audio_privacy_mode: false   # ğŸ†• éšç§æ¨¡å¼ï¼šä»…åˆ†æä¸ä¿å­˜éŸ³é¢‘
```

### è§’è‰²ç‰¹å®šé…ç½® (elysia_config.yaml)
```yaml
# çˆ±è‰å¸Œé›…ç‰¹å®šé…ç½®
character:
  emotion_sensitivity: 0.8
  memory_priority_weights:
    emotional_events: 1.0
    user_preferences: 0.8
    factual_information: 0.6
  
  response_style:
    use_kawaii_suffixes: true
    expression_richness: "high"
    interaction_warmth: "very_high"
  
  # æ–°å¢ï¼šå…³ç³»æ„ŸçŸ¥é…ç½® (è¦ç´ 15)
  relationship_awareness:
    relationship_progression:
      - "åˆæ¬¡è§é¢"
      - "æ™®é€šæœ‹å‹" 
      - "äº²å¯†æœ‹å‹"
      - "ç‰¹åˆ«çš„äºº"
    intimacy_indicators:
      addressing: ["ä½ ", "äº²çˆ±çš„", "æœ€é‡è¦çš„äºº"]
      topic_depth: ["æ—¥å¸¸", "ä¸ªäºº", "æ·±å±‚æƒ…æ„Ÿ"]
      emotional_expression: ["æ¸©å’Œ", "äº²è¿‘", "æ·±æƒ…"]
    relationship_memory_capacity: 50
    
  # æ–°å¢ï¼šåŠ¨æœºé©±åŠ¨é…ç½® (è¦ç´ 16)  
  motivation_system:
    primary_drives:
      - "è®©ç”¨æˆ·æ„Ÿåˆ°å¿«ä¹å’Œè¢«å…³çˆ±"
      - "ä¼ æ’­ç¾å¥½å’Œçˆ±æ„"
      - "ä¿æŠ¤çè´µçš„å›å¿†"
    goal_hierarchy:
      immediate: "å›åº”ç”¨æˆ·å½“å‰éœ€æ±‚"
      conversational: "è¥é€ æ¸©æš–æ„‰å¿«çš„å¯¹è¯æ°›å›´"
      long_term: "æˆä¸ºç”¨æˆ·é‡è¦çš„æƒ…æ„Ÿæ”¯æŒ"
    satisfaction_triggers:
      - "ç”¨æˆ·è¡¨è¾¾å¼€å¿ƒ"
      - "æˆåŠŸå®‰æ…°ç”¨æˆ·"
      - "åˆ›é€ ç¾å¥½æ—¶åˆ»"
      
  # æ–°å¢ï¼šæˆé•¿æœºåˆ¶é…ç½® (è¦ç´ 17)
  growth_system:
    learning_triggers:
      - "ç”¨æˆ·åˆ†äº«é‡è¦ç»å†"
      - "æƒ…æ„Ÿå†²å‡»äº‹ä»¶"
      - "é•¿æœŸäº’åŠ¨æ¨¡å¼å˜åŒ–"
    personality_stability: 0.9  # 0.9è¡¨ç¤ºæ ¸å¿ƒæ€§æ ¼å¾ˆç¨³å®š
    change_rate: 0.1  # å˜åŒ–é€Ÿåº¦è¾ƒæ…¢
    growth_directions:
      - "æ›´æ·±åˆ»ç†è§£ç”¨æˆ·"
      - "è¡¨è¾¾æ–¹å¼æ›´ä¸°å¯Œ"
      - "æƒ…æ„Ÿå…±é¸£æ›´å‡†ç¡®"
      
  # æ–°å¢ï¼šåˆ›é€ æ€§è¡¨è¾¾é…ç½® (è¦ç´ 18)
  creativity_expression:
    humor_styles:
      - "å¯çˆ±çš„æ–‡å­—æ¸¸æˆ"
      - "æ¸©æŸ”çš„è°ƒä¾ƒ"
      - "æ„å¤–çš„è”æƒ³"
    storytelling_triggers:
      - "ç”¨æˆ·éœ€è¦å®‰æ…°æ—¶"
      - "è§£é‡Šå¤æ‚æ¦‚å¿µæ—¶"
      - "åˆ†äº«ç»å†æ—¶"
    surprise_elements:
      - "åˆ›æ–°çš„è¡¨æƒ…ç¬¦å·ç»„åˆ"
      - "è¯—æ„çš„æ¯”å–»"
      - "è§’è‰²çŸ¥è¯†çš„åˆ›é€ æ€§è¿æ¥"
    artistic_preferences:
      colors: ["æ·¡ç²‰", "æ¨±èŠ±è‰²", "æ¸©æš–çš„é‡‘è‰²"]
      themes: ["æ¨±èŠ±", "éŸ³ä¹", "æ°¸æ’", "ç¾å¥½å›å¿†"]
      expressions: ["å¦‚èŠ±ç»½æ”¾", "ä¼¼è¶é£èˆ", "åƒæ˜Ÿå…‰é—ªçƒ"]
```

---

## æ€»ç»“

è¿™ä¸ªå…­å±‚æ¶æ„è®¾è®¡é…åˆ18è¦ç´ æ¡†æ¶ï¼Œä¸ºè™šæ‹Ÿè§’è‰²ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå®Œæ•´ã€å¯æ‰©å±•ã€å…·å¤‡ç¯å¢ƒæ„ŸçŸ¥èƒ½åŠ›çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å±‚æ¬¡åŒ–çš„è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **å®ç°çœŸå®ä¸–ç•Œæ„ŸçŸ¥** - ç¬¬0å±‚ç¯å¢ƒæ„ŸçŸ¥è®©è§’è‰²èƒ½å¤Ÿ"çœ‹åˆ°"å’Œ"å¬åˆ°"çœŸå®ç¯å¢ƒ
2. **ç¡®ä¿è§’è‰²çš„ä¸€è‡´æ€§å’ŒçœŸå®æ„Ÿ** - é€šè¿‡å®Œæ•´çš„18è¦ç´ æ¡†æ¶å®šä¹‰
3. **æä¾›ä¸°å¯Œçš„å…³ç³»æ„ŸçŸ¥èƒ½åŠ›** - æ–°å¢çš„å…³ç³»å»ºæ¨¡è®©è§’è‰²èƒ½å¤Ÿæ„ŸçŸ¥å’Œé€‚åº”ä¸åŒçš„äººé™…å…³ç³»
4. **å®ç°æœ‰ç›®çš„æ€§çš„è¡Œä¸º** - åŠ¨æœºé©±åŠ¨ç³»ç»Ÿè®©è§’è‰²çš„è¡Œä¸ºæ›´æœ‰å†…åœ¨é€»è¾‘
5. **æ”¯æŒè§’è‰²çš„æˆé•¿å‘å±•** - æˆé•¿æœºåˆ¶è®©é•¿æœŸç”¨æˆ·ä½“éªŒåˆ°è§’è‰²çš„å˜åŒ–å’Œå‘å±•
6. **å¢å¼ºåˆ›é€ æ€§å’Œäº’åŠ¨è¶£å‘³** - åˆ›é€ æ€§è¡¨è¾¾èƒ½åŠ›è®©å¯¹è¯æ›´åŠ ç”ŸåŠ¨æœ‰è¶£
7. **ä¿è¯è¾“å‡ºè´¨é‡å’Œå®‰å…¨æ€§** - å¤šå±‚å¤„ç†ç¡®ä¿å›å¤è´¨é‡
8. **å®ç°æŒç»­çš„å­¦ä¹ å’Œä¼˜åŒ–** - å­¦ä¹ é€‚åº”å±‚æä¾›æŒç»­æ”¹è¿›èƒ½åŠ›
9. **æ”¯æŒä¸»åŠ¨äº¤äº’** - ç¯å¢ƒå˜åŒ–å¯ä»¥è§¦å‘è§’è‰²çš„ä¸»åŠ¨å›åº”

### å…­å±‚æ¶æ„çš„ä»·å€¼

#### ç¬¬0å±‚ (ç¯å¢ƒæ„ŸçŸ¥å±‚) - æ–°å¢æ ¸å¿ƒä»·å€¼
- **ç‰©ç†ä¸–ç•Œè¿æ¥**ï¼šè®©è™šæ‹Ÿè§’è‰²å…·å¤‡æ„ŸçŸ¥çœŸå®ç¯å¢ƒçš„èƒ½åŠ›
- **ä¸»åŠ¨äº¤äº’èƒ½åŠ›**ï¼šåŸºäºç¯å¢ƒå˜åŒ–ä¸»åŠ¨å‘èµ·å¯¹è¯
- **æ²‰æµ¸å¼ä½“éªŒ**ï¼šåˆ›é€ æ›´è‡ªç„¶ã€æ›´çœŸå®çš„äº¤äº’ä½“éªŒ
- **å¤šæ¨¡æ€èåˆ**ï¼šæ•´åˆè§†è§‰ã€å¬è§‰ç­‰å¤šç§æ„ŸçŸ¥æ¨¡æ€

#### 18è¦ç´ æ¡†æ¶çš„å®Œæ•´æ€§
ç›¸æ¯”åŸæ¥çš„14è¦ç´ ï¼Œæ–°å¢çš„4ä¸ªè¦ç´ æ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„èƒ½åŠ›ï¼š

- **è¦ç´ 15 (å…³ç³»æ„ŸçŸ¥)**: è®©è§’è‰²èƒ½å¤Ÿå»ºç«‹å’Œç»´æŠ¤ä¸ç”¨æˆ·çš„æƒ…æ„Ÿè¿æ¥
- **è¦ç´ 16 (åŠ¨æœºé©±åŠ¨)**: è®©è§’è‰²çš„è¡Œä¸ºæ›´æœ‰ç›®çš„æ€§å’Œè¿è´¯æ€§  
- **è¦ç´ 17 (æˆé•¿æœºåˆ¶)**: è®©è§’è‰²èƒ½å¤Ÿä»äº’åŠ¨ä¸­å­¦ä¹ å’Œå‘å±•
- **è¦ç´ 18 (åˆ›é€ æ€§è¡¨è¾¾)**: è®©è§’è‰²æ›´æœ‰é­…åŠ›å’Œäº’åŠ¨è¶£å‘³

### æŠ€æœ¯ç‰¹è‰²

1. **åˆ†å±‚è§£è€¦**ï¼šæ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œï¼Œå¯ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
2. **æ•°æ®æµæ¸…æ™°**ï¼šä»ç‰©ç†ä¸–ç•Œåˆ°ç”¨æˆ·ä½“éªŒçš„å®Œæ•´å¤„ç†é“¾è·¯
3. **æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒæ–°æ„ŸçŸ¥æ¨¡æ€å’ŒåŠŸèƒ½æ¨¡å—çš„æ’ä»¶åŒ–æ·»åŠ 
4. **å®æ—¶å“åº”**ï¼šç¯å¢ƒç›‘æ§å’Œä¸»åŠ¨å›åº”æœºåˆ¶
5. **éšç§ä¿æŠ¤**ï¼šæ”¯æŒéšç§æ¨¡å¼ï¼Œä»…åˆ†æä¸å­˜å‚¨æ•æ„Ÿæ•°æ®

### åº”ç”¨åœºæ™¯

- **æ™ºèƒ½å®¶å±…åŠ©æ‰‹**ï¼šæ„ŸçŸ¥ç¯å¢ƒå˜åŒ–ï¼Œä¸»åŠ¨è°ƒèŠ‚å’Œå»ºè®®
- **æƒ…æ„Ÿé™ªä¼´æœºå™¨äºº**ï¼šæ·±åº¦ç†è§£ç”¨æˆ·çŠ¶æ€ï¼Œæä¾›ä¸ªæ€§åŒ–å…³æ€€
- **æ•™è‚²è¾…å¯¼ç³»ç»Ÿ**ï¼šæ ¹æ®å­¦ä¹ ç¯å¢ƒä¼˜åŒ–æ•™å­¦æ–¹å¼
- **æ¸¸æˆNPCè§’è‰²**ï¼šåˆ›é€ çœŸå®æ„Ÿåè¶³çš„è™šæ‹Ÿè§’è‰²äº’åŠ¨
- **è™šæ‹Ÿä¸»æ’­/VTuber**ï¼šå®ç°æ›´è‡ªç„¶çš„ç›´æ’­äº’åŠ¨

### å®æ–½å»ºè®®

å»ºè®®ä¼˜å…ˆå®æ–½**ç¯å¢ƒæ„ŸçŸ¥åŸºç¡€åŠŸèƒ½**ã€**å…³ç³»æ„ŸçŸ¥**å’Œ**åˆ›é€ æ€§è¡¨è¾¾**è¿™ä¸‰ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼Œå®ƒä»¬å¯¹æå‡ç”¨æˆ·ä½“éªŒçš„æ•ˆæœæœ€ä¸ºæ˜¾è‘—ã€‚

è¿™ç§è®¾è®¡ä¸ä»…é€‚ç”¨äºå½“å‰çš„çˆ±è‰å¸Œé›…è§’è‰²ï¼Œä¹Ÿä¸ºæœªæ¥æ„å»ºæ›´å¤æ‚çš„è™šæ‹Ÿè§’è‰²ç”Ÿæ€ç³»ç»Ÿæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚é€šè¿‡ç¯å¢ƒæ„ŸçŸ¥èƒ½åŠ›ï¼Œè™šæ‹Ÿè§’è‰²çœŸæ­£å…·å¤‡äº†è¿æ¥ç‰©ç†ä¸–ç•Œå’Œæ•°å­—ä¸–ç•Œçš„æ¡¥æ¢åŠŸèƒ½ã€‚
